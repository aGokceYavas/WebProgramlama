@{
    ViewData["Title"] = "Akıllı Antrenör";
    string aktifSekme = ViewBag.AktifSekme as string ?? "program";
}

<div class="container py-5">
    
    <div class="text-center mb-4">
        <h2 class="fw-bold">Akıllı Antrenör</h2>
    </div>

    @if (ViewBag.Hata != null)
    {
        <div class="alert alert-danger text-center">@ViewBag.Hata</div>
    }

    <ul class="nav nav-pills mb-4 justify-content-center" id="anaTablar">
        <li class="nav-item"><button class="nav-link @(aktifSekme == "program" ? "active" : "")" onclick="sekmeAc('program')">Haftalık Program</button></li>
        <li class="nav-item"><button class="nav-link @(aktifSekme == "yemek" ? "active" : "")" onclick="sekmeAc('yemek')">Yemek Analizi</button></li>
    </ul>

    <div id="alan-program" style="display: @(aktifSekme == "program" ? "block" : "none")">
        <div class="row g-5">
            <div class="col-md-4">
                <div class="card p-4 shadow-sm border-0">
                    <form asp-action="ProgramOlustur" method="post">
                        <div class="mb-2"><label>Yaş</label><input type="number" name="yas" class="form-control" value="@ViewBag.Yas" required /></div>
                        <div class="mb-2"><label>Kilo</label><input type="number" name="kilo" class="form-control" value="@ViewBag.Kilo" required /></div>
                        <div class="mb-2"><label>Boy</label><input type="number" name="boy" class="form-control" value="@ViewBag.Boy" required /></div>
                        <div class="mb-2"><label>Cinsiyet</label><select name="cinsiyet" class="form-select"><option>Erkek</option><option>Kadın</option></select></div>
                        <div class="mb-3"><label>Hedef</label><select name="hedef" class="form-select"><option>Kilo Vermek</option><option>Kas Yapmak</option></select></div>
                        <button class="btn btn-primary w-100" onclick="loading('load1')">Oluştur</button>
                    </form>
                </div>
            </div>
            <div class="col-md-8">
                <div id="load1" style="display:none;" class="text-center p-5"><div class="spinner-border text-primary"></div></div>
                @if (ViewBag.Sonuc != null && aktifSekme == "program")
                {
                    <div class="card p-4 shadow border-0">@Html.Raw(ViewBag.Sonuc)</div>
                }
            </div>
        </div>
    </div>

    <div id="alan-yemek" style="display: @(aktifSekme == "yemek" ? "block" : "none")">
        <div class="text-center mb-4">
            <div class="card d-inline-block p-4 shadow border-0">
                <h5>Healthy Swap</h5>
                <form asp-action="YemekAnalizi" method="post" enctype="multipart/form-data" class="d-flex gap-2 justify-content-center mt-3">
                    <input type="file" name="resimDosyasi" class="form-control" accept="image/*" required />
                    <button type="submit" class="btn btn-success" onclick="loading('load2')">Analiz Et</button>
                </form>
            </div>
        </div>

        <div id="load2" style="display:none;" class="text-center p-5"><div class="spinner-border text-success"></div><p>Analiz ediliyor...</p></div>

        @if (ViewBag.YuklenenResim != null)
        {
            <div class="row">
                <div class="col-md-6 mb-3">
                    <div class="card shadow-sm h-100">
                        <div class="card-header bg-danger text-white text-center">Yediğin</div>
                        <div class="card-body p-0"><img src="@ViewBag.YuklenenResim" class="w-100" style="height:300px; object-fit:cover;" /></div>
                    </div>
                </div>
                
                <div class="col-md-6 mb-3">
                    <div class="card shadow-sm h-100 border-success">
                        <div class="card-header bg-success text-white text-center">Önerilen</div>
                        <div class="card-body p-0 d-flex align-items-center justify-content-center bg-light">
                            @if(!string.IsNullOrEmpty(ViewBag.UretilenResim))
                            {
                                <img src="@ViewBag.UretilenResim" class="w-100" style="height:300px; object-fit:cover;" onerror="this.src='https://placehold.co/600x400?text=Resim+Yuklenemedi'; this.onerror=null;" />
                            }
                            else
                            {
                                <span class="text-muted">Resim oluşturulamadı.</span>
                            }
                        </div>
                    </div>
                </div>
            </div>

            @if(ViewBag.YemekAciklamasi != null)
            {
                <div class="card p-4 shadow-sm border-success mt-3">@Html.Raw(ViewBag.YemekAciklamasi)</div>
            }
        }
    </div>
</div>

<script>
    function sekmeAc(id) {
        document.getElementById('alan-program').style.display = 'none';
        document.getElementById('alan-yemek').style.display = 'none';
        document.getElementById('alan-' + id).style.display = 'block';
        document.querySelectorAll('#anaTablar .nav-link').forEach(b => b.classList.remove('active'));
        event.currentTarget.classList.add('active');
    }
    function loading(id) { document.getElementById(id).style.display = 'block'; }
</script>

<style>
    .nav-pills .nav-link { background: #f8f9fa; color: #555; margin: 0 5px; cursor: pointer; }
    .nav-pills .nav-link.active { background: #0d6efd; color: #fff; }
    .nav-pills .nav-link.active[onclick*="yemek"] { background: #198754; }
</style>

<script>
    function sekmeAc(id) {
        document.getElementById('alan-program').style.display = 'none';
        document.getElementById('alan-yemek').style.display = 'none';
        document.getElementById('alan-' + id).style.display = 'block';
        document.querySelectorAll('#anaTablar .nav-link').forEach(b => b.classList.remove('active'));
        event.currentTarget.classList.add('active');
    }
    function loading(id) { document.getElementById(id).style.display = 'block'; }
</script>

<style>
    .nav-pills .nav-link {
        background-color:  #198754;
        color: #555;
        margin: 0 5px;
        cursor: pointer;
    }

        .nav-pills .nav-link.active {
            background: #0d6efd;
            color: #1000;
        }

            .nav-pills .nav-link.active[onclick*="yemek"] {
                background: #0d6efd;
            }
</style>